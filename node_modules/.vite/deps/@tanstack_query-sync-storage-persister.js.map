{
  "version": 3,
  "sources": ["../../@tanstack/query-sync-storage-persister/src/index.ts"],
  "sourcesContent": ["import type {\n  PersistRetryer,\n  PersistedClient,\n  Persister,\n} from '@tanstack/query-persist-client-core'\n\ninterface Storage {\n  getItem: (key: string) => string | null\n  setItem: (key: string, value: string) => void\n  removeItem: (key: string) => void\n}\n\ninterface CreateSyncStoragePersisterOptions {\n  /** The storage client used for setting and retrieving items from cache.\n   * For SSR pass in `undefined`. Note that window.localStorage can be\n   * `null` in Android WebViews depending on how they are configured.\n   */\n  storage: Storage | undefined | null\n  /** The key to use when storing the cache */\n  key?: string\n  /** To avoid spamming,\n   * pass a time in ms to throttle saving the cache to disk */\n  throttleTime?: number\n  /**\n   * How to serialize the data to storage.\n   * @default `JSON.stringify`\n   */\n  serialize?: (client: PersistedClient) => string\n  /**\n   * How to deserialize the data from storage.\n   * @default `JSON.parse`\n   */\n  deserialize?: (cachedString: string) => PersistedClient\n\n  retry?: PersistRetryer\n}\n\nexport function createSyncStoragePersister({\n  storage,\n  key = `REACT_QUERY_OFFLINE_CACHE`,\n  throttleTime = 1000,\n  serialize = JSON.stringify,\n  deserialize = JSON.parse,\n  retry,\n}: CreateSyncStoragePersisterOptions): Persister {\n  if (storage) {\n    const trySave = (persistedClient: PersistedClient): Error | undefined => {\n      try {\n        storage.setItem(key, serialize(persistedClient))\n        return\n      } catch (error) {\n        return error as Error\n      }\n    }\n    return {\n      persistClient: throttle((persistedClient) => {\n        let client: PersistedClient | undefined = persistedClient\n        let error = trySave(client)\n        let errorCount = 0\n        while (error && client) {\n          errorCount++\n          client = retry?.({\n            persistedClient: client,\n            error,\n            errorCount,\n          })\n\n          if (client) {\n            error = trySave(client)\n          }\n        }\n      }, throttleTime),\n      restoreClient: () => {\n        const cacheString = storage.getItem(key)\n\n        if (!cacheString) {\n          return\n        }\n\n        return deserialize(cacheString) as PersistedClient\n      },\n      removeClient: () => {\n        storage.removeItem(key)\n      },\n    }\n  }\n\n  return {\n    persistClient: noop,\n    restoreClient: () => undefined,\n    removeClient: noop,\n  }\n}\n\nfunction throttle<TArgs extends any[]>(\n  func: (...args: TArgs) => any,\n  wait = 100,\n) {\n  let timer: ReturnType<typeof setTimeout> | null = null\n  let params: TArgs\n  return function (...args: TArgs) {\n    params = args\n    if (timer === null) {\n      timer = setTimeout(() => {\n        func(...params)\n        timer = null\n      }, wait)\n    }\n  }\n}\n\n// eslint-disable-next-line @typescript-eslint/no-empty-function\nfunction noop() {}\n"],
  "mappings": ";;;AAqCO,SAASA,2BAA2B;EACzCC;EACAC,MAFyC;EAGzCC,eAAe;EACfC,YAAYC,KAAKC;EACjBC,cAAcF,KAAKG;EACnBC;AANyC,GAOM;AAC/C,MAAIR,SAAS;AACX,UAAMS,UAAWC,qBAAwD;AACvE,UAAI;AACFV,gBAAQW,QAAQV,KAAKE,UAAUO,eAAD,CAA9B;AACA;eACOE,OAAO;AACd,eAAOA;MACR;;AAEH,WAAO;MACLC,eAAeC,SAAUJ,qBAAoB;AAC3C,YAAIK,SAAsCL;AAC1C,YAAIE,QAAQH,QAAQM,MAAD;AACnB,YAAIC,aAAa;AACjB,eAAOJ,SAASG,QAAQ;AACtBC;AACAD,mBAASP,SAAAA,OAAAA,SAAAA,MAAQ;YACfE,iBAAiBK;YACjBH;YACAI;UAHe,CAAH;AAMd,cAAID,QAAQ;AACVH,oBAAQH,QAAQM,MAAD;UAChB;QACF;SACAb,YAhBoB;MAiBvBe,eAAe,MAAM;AACnB,cAAMC,cAAclB,QAAQmB,QAAQlB,GAAhB;AAEpB,YAAI,CAACiB,aAAa;AAChB;QACD;AAED,eAAOZ,YAAYY,WAAD;;MAEpBE,cAAc,MAAM;AAClBpB,gBAAQqB,WAAWpB,GAAnB;MACD;;EAEJ;AAED,SAAO;IACLY,eAAeS;IACfL,eAAe,MAAMM;IACrBH,cAAcE;;AAEjB;AAED,SAASR,SACPU,MACAC,OAAO,KACP;AACA,MAAIC,QAA8C;AAClD,MAAIC;AACJ,SAAO,YAAaC,MAAa;AAC/BD,aAASC;AACT,QAAIF,UAAU,MAAM;AAClBA,cAAQG,WAAW,MAAM;AACvBL,aAAK,GAAGG,MAAJ;AACJD,gBAAQ;SACPD,IAHe;IAInB;;AAEJ;AAGD,SAASH,OAAO;AAAA;",
  "names": ["createSyncStoragePersister", "storage", "key", "throttleTime", "serialize", "JSON", "stringify", "deserialize", "parse", "retry", "trySave", "persistedClient", "setItem", "error", "persistClient", "throttle", "client", "errorCount", "restoreClient", "cacheString", "getItem", "removeClient", "removeItem", "noop", "undefined", "func", "wait", "timer", "params", "args", "setTimeout"]
}
